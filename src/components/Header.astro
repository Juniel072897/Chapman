---
/* src/components/Header.astro */
---

<header class="site-header">
  <!-- Top trust bar -->
  <div class="topbar">
    <div class="container topbar__inner">
      <span class="topbar__text">Most Trusted Plumbing Services in the Alabama Area</span>
      <a href="/ontact" class="topbar__cta">Request for a Service</a>

      <!-- Mobile/Tablet only call button -->
      <a href="tel:2052365014" class="topbar__call" aria-label="Call Chapman Plumbing at 205-236-5014">
        Call 205-236-5014
      </a>
    </div>
  </div>

  <!-- Main nav -->
  <div class="navwrap" id="stickyNav">
    <div class="container nav">
      <!-- Left: Logo -->
      <a href="/" class="logo" aria-label="Chapman Plumbing home">
        <img src="/images/chapman-logo.png" alt="Chapman Plumbing" />
      </a>

      <!-- Center: Desktop menu -->
      <nav id="navMenu" class="menu" aria-label="Primary">
        <ul class="menu__list">
          <li><a href="/" class="active">Home</a></li>
          <li><a href="/about">About</a></li>

          <!-- Services (desktop dropdown) -->
          <li class="has-submenu">
            <a href="/Services" class="link parent-link">Services ▾</a>
            <ul id="submenu-services" class="submenu submenu--red">
              <li><a href="/services/residential-plumbing">Residential Plumbing</a></li>
              <li><a href="/services/repair">Repair</a></li>
              <li><a href="/services/installation">Installation</a></li>
              <li><a href="/services/hydro-jetting">Hydro Jetting</a></li>
              <li><a href="/services/specialty">Specialty</a></li>
              <li><a href="/services/commercial-plumbing">Commercial Plumbing</a></li>
            </ul>
          </li>

          <!-- Service Area (desktop dropdown) -->
          <li class="has-submenu">
            <a href="/ServiceAreas" class="link parent-link">Service Area ▾</a>
            <ul id="submenu-areas" class="submenu submenu--red">
              <li><a href="/service-area/shannon">Shannon</a></li>
              <li><a href="/service-area/bessemer">Bessemer</a></li>
              <li><a href="/service-area/hoover">Hoover</a></li>
              <li><a href="/service-area/birmingham">Birmingham</a></li>
              <li><a href="/service-area/brighton">Brighton</a></li>
              <li><a href="/service-area/fairfield">Fairfield</a></li>
              <li><a href="/service-area/homewood">Homewood</a></li>
              <li><a href="/service-area/hueytown">Hueytown</a></li>
              <li><a href="/service-area/indian-springs-village">Indian Springs Village</a></li>
              <li><a href="/service-area/midfield">Midfield</a></li>
              <li><a href="/service-area/mountain-brook">Mountain Brook</a></li>
              <li><a href="/service-area/vestavia-hills">Vestavia Hills</a></li>
              <li><a href="/service-area/wine-ridge">Wine Ridge</a></li>
              <li><a href="/service-area/alabaster">Alabaster</a></li>
            </ul>
          </li>

          <li><a href="/Review">Reviews</a></li>
          <li><a href="/blog">Blog</a></li>
          <a href="/Contact" class="drawer-link">Contact</a>
        </ul>
      </nav>

      <!-- Right: Desktop call button + hamburger (hamburger hidden on desktop) -->
      <div class="right-cta">
        <a class="cta btn-success desktop-call" href="tel:2052365014">Call 205-236-5014</a>
        <button id="navToggle" class="menu-toggle" aria-expanded="false" aria-controls="navMenu" aria-label="Open menu">
          <svg width="28" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Drawer overlay (mobile/tablet) -->
  <div id="navOverlay" class="nav-overlay" aria-hidden="true"></div>

  <!-- Drawer panel (mobile/tablet) -->
  <aside
    id="navDrawer"
    class="nav-drawer"
    aria-hidden="true"
    role="dialog"
    aria-modal="true"
    aria-label="Mobile navigation"
  >
    <div class="drawer-header">
      <span class="drawer-title"></span>
      <button id="navClose" class="drawer-close" aria-label="Close menu">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <!-- SCROLLABLE AREA -->
    <div class="drawer-scroll">
      <nav class="drawer-body">
        <a href="/" class="drawer-link active">Home</a>
        <a href="/about" class="drawer-link">About</a>

        <!-- Services -->
        <div class="drawer-acc-row">
          <a href="/Services" class="drawer-acc-link">Services</a>
          <button class="drawer-acc-toggle" data-acc="services" aria-expanded="false" aria-controls="panel-services" aria-label="Toggle Services submenu">
            <svg class="chev" width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
        </div>
        <div id="panel-services" class="drawer-panel">
          <ul class="submenu--red drawer-redlist">
            <li><a href="/services/residential-plumbing">Residential Plumbing</a></li>
            <li><a href="/services/repair">Repair</a></li>
            <li><a href="/services/installation">Installation</a></li>
            <li><a href="/services/hydro-jetting">Hydro Jetting</a></li>
            <li><a href="/services/specialty">Specialty</a></li>
            <li><a href="/services/commercial-plumbing">Commercial Plumbing</a></li>
          </ul>
        </div>

        <!-- Service Area -->
        <div class="drawer-acc-row">
          <a href="/ServiceAreas" class="drawer-acc-link">Service Area</a>
          <button class="drawer-acc-toggle" data-acc="areas" aria-expanded="false" aria-controls="panel-areas" aria-label="Toggle Service Area submenu">
            <svg class="chev" width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
        </div>
        <div id="panel-areas" class="drawer-panel">
          <ul class="submenu--red drawer-redlist">
            <li><a href="/service-area/shannon">Shannon</a></li>
            <li><a href="/service-area/bessemer">Bessemer</a></li>
            <li><a href="/service-area/hoover">Hoover</a></li>
            <li><a href="/service-area/birmingham">Birmingham</a></li>
            <li><a href="/service-area/brighton">Brighton</a></li>
            <li><a href="/service-area/fairfield">Fairfield</a></li>
            <li><a href="/service-area/homewood">Homewood</a></li>
            <li><a href="/service-area/hueytown">Hueytown</a></li>
            <li><a href="/service-area/indian-springs-village">Indian Springs Village</a></li>
            <li><a href="/service-area/midfield">Midfield</a></li>
            <li><a href="/service-area/mountain-brook">Mountain Brook</a></li>
            <li><a href="/service-area/vestavia-hills">Vestavia Hills</a></li>
            <li><a href="/service-area/wine-ridge">Wine Ridge</a></li>
            <li><a href="/service-area/alabaster">Alabaster</a></li>
          </ul>
        </div>

        <a href="/reviews" class="drawer-link">Reviews</a>
        <a href="/blog" class="drawer-link">Blog</a>
        <a href="/Contact" class="drawer-link">Contact</a>
      </nav>
    </div>
  </aside>
</header>

<style>
  /* Container sizes */
  :root{
    --container-max: 1300px;
    --container-max-wide: 1360px;
    --container-pad: 16px;
  }
  .container{
    width: min(100% - (var(--container-pad) * 2), var(--container-max));
    margin-inline: auto;
    padding-inline: var(--container-pad);
  }
  @media (min-width: 981px){
    .navwrap .container{
      width: min(100% - (var(--container-pad) * 2), var(--container-max-wide));
    }
  }

  /* Top bar */
  .topbar { background: var(--color-primary-red); color: var(--color-white); }
  .topbar__inner { display: flex; align-items: center; justify-content: space-between; padding-block: .5rem; gap: .75rem; }
  .topbar__cta { color: var(--color-white); }
  .topbar__call { display: none; background:#177a3f; color:#fff; font-weight:800; text-decoration:none; padding:.55rem 1rem; border-radius:8px; white-space:nowrap; box-shadow:0 6px 20px rgba(0,0,0,.15); }

  /* ===== Main nav row ===== */
  .navwrap{
    /* Try native sticky first */
    position: sticky;
    position: -webkit-sticky; /* Safari */
    top: 0;
    z-index: 1000;
    background: var(--color-white);
    border-bottom: 1px solid rgba(0,0,0,.06);
    transition: box-shadow .18s ease;
  }
  /* JS fallback switches to fixed when needed */
  .navwrap.fixed{
    position: fixed;
    left: 0; right: 0; top: 0;
  }
  .navwrap.is-stuck{
    box-shadow: 0 6px 20px rgba(0,0,0,.08);
    border-bottom-color: transparent;
  }

  .nav { display: flex; align-items: center; gap: 1rem; padding-block: .55rem; position: relative; }
  .logo img { height: 78px; display: block; }

  @media (min-width: 981px){
    .nav{
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      column-gap: 28px;
    }
    .logo{ justify-self: start; }
    .menu{ justify-self: center; display: flex; align-items: center; gap: 1rem; }
    .right-cta{ justify-self: end; display:flex; align-items:center; gap:12px; }
    .desktop-call{ display:inline-flex; }
  }

  .menu__list { list-style:none; display:flex; align-items:center; gap:1.6rem; margin:0; padding:0; }
  .menu__list a { color: var(--color-dark-charcoal); font-weight:500; padding:.5rem .25rem; }
  .menu__list a:hover, .menu__list a.active { color: var(--color-primary-red); }

  .has-submenu { position: relative; }
  .link { background:none; border:0; cursor:pointer; padding:.5rem .25rem; font:inherit; font-weight:500; color:var(--color-dark-charcoal); }
  .link:hover { color: var(--color-primary-red); }

  .submenu{
    position:absolute; top:100%; left:0; min-width:260px;
    background:var(--color-white); border:1px solid rgba(0,0,0,.08); border-radius:8px;
    box-shadow:0 6px 24px rgba(0,0,0,.08); padding:.25rem 0; display:none; z-index:20;
  }
  .submenu li{ list-style:none; }
  .submenu a{ display:block; padding:.85rem 1rem; color:var(--color-dark-charcoal); }
  .submenu a:hover{ background:var(--color-light-gray); }

  .submenu--red{ background:var(--color-primary-red); border-color:var(--color-primary-red); }
  .submenu--red a{ color:#fff; }
  .submenu--red li + li a{ border-top:1px dashed rgba(255,255,255,.6); }
  .submenu--red a:hover{ background:#1A1A1A; color:#fff; }

  .cta{ font-weight:700; border-radius:10px; text-decoration:none; padding:.7rem 1rem; white-space:nowrap; }
  .btn-success{ background-color: var(--color-primary-green); color:#fff; }
  .btn-success:hover{ background-color:#006918; color:#fff; }
  .menu-toggle{ margin-left:auto; background:transparent; border:0; cursor:pointer; display:none; color:var(--color-dark-charcoal); }

  @media (min-width: 981px){
    .menu-toggle{ display:none; }
    .has-submenu:hover > .submenu,
    .has-submenu:focus-within > .submenu { display:block; }
  }

  /* Drawer / overlay sit ABOVE sticky/fixed nav */
  .nav-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.5); opacity:0; pointer-events:none; transition:opacity .18s ease; z-index:1050; }
  .nav-overlay.open{ opacity:1; pointer-events:auto; }

  .nav-drawer{
    position:fixed; top:0; right:0; height:100dvh; width:min(84vw,420px);
    background:#1A1A1A; color:#fff; box-shadow:-12px 0 40px rgba(0,0,0,.35);
    transform:translateX(100%); transition:transform .22s ease-out; z-index:1100;
    display:none; overflow:hidden; flex-direction:column;
  }
  .nav-drawer.open{ transform:translateX(0); }

  .drawer-header{ flex:0 0 auto; display:flex; align-items:center; justify-content:space-between; padding:1rem 1rem .5rem; border-bottom:1px solid rgba(255,255,255,.12); }
  .drawer-title{ font-weight:700; font-size:1rem; }
  .drawer-close{ background:transparent; border:1px solid rgba(255,255,255,.16); color:#fff; border-radius:8px; padding:.4rem; cursor:pointer; }

  .drawer-scroll{ flex:1 1 auto; overflow-y:auto; -webkit-overflow-scrolling:touch; overscroll-behavior:contain; padding:.25rem 1rem 1rem; padding-bottom:calc(1rem + env(safe-area-inset-bottom,0px)); }
  .drawer-body{ display:grid; gap:.25rem; }

  .drawer-link{ color:#fff; text-decoration:none; padding:1rem .25rem; border-bottom:1px solid rgba(255,255,255,.12); font-weight:600; display:block; }
  .drawer-link:hover{ background:rgba(255,255,255,.06); color:#fff; }
  .drawer-link.active{ color:var(--color-primary-red); }

  .drawer-acc-row{
    margin-top:.5rem; display:flex; align-items:center; gap:.75rem;
    border:1px solid rgba(255,255,255,.16); border-radius:10px; padding:.65rem .75rem;
  }
  .drawer-acc-link{ color:#fff; font-weight:700; text-decoration:none; flex:1; }
  .drawer-acc-link:hover{ text-decoration:underline; }
  .drawer-acc-toggle{
    background:transparent; border:1px solid rgba(255,255,255,.16); color:#fff;
    border-radius:8px; padding:.35rem; display:inline-flex; align-items:center; justify-content:center; cursor:pointer;
  }
  .drawer-acc-toggle[aria-expanded="true"]{ color: var(--color-primary-red); }

  .drawer-panel{ max-height:0; overflow:hidden; transition:max-height .2s ease; }
  .drawer-panel.open{ max-height:800px; }

  .drawer-redlist{ list-style:none; margin:.5rem 0 0; padding:0; border-radius:8px; overflow:hidden; }
  .drawer-redlist a{ display:block; color:#fff; padding:.9rem 1rem; }
  .drawer-redlist li + li a{ border-top:1px dashed rgba(255,255,255,.6); }
  .drawer-redlist a:hover{ background:#1A1A1A; color:#fff; }

  /* MOBILE */
  @media (max-width: 980px) {
    .topbar__text, .topbar__cta { display: none; }
    .topbar__inner { justify-content: center; padding-block: .55rem; }
    .topbar__call { display:inline-flex; align-items:center; justify-content:center; }

    .nav { display:flex; align-items:center; justify-content:space-between; gap:0; }
    .menu { display: none !important; }
    .menu-toggle { display: inline-flex; }
    .desktop-call { display: none; }
    .nav-drawer { display: flex; }
  }

  /* Prevent anchor targets being hidden under sticky header */
  :where(section,[id]){ scroll-margin-top: 90px; }
</style>

<script is:inline>
  window.addEventListener('DOMContentLoaded', () => {
    const toggle = document.getElementById('navToggle');
    const closeBtn = document.getElementById('navClose');
    const drawer = document.getElementById('navDrawer');
    const overlay = document.getElementById('navOverlay');
    const nav = document.getElementById('stickyNav');

    /* ----- Drawer open/close ----- */
    const openDrawer = () => {
      if (!drawer || !overlay || !toggle) return;
      drawer.classList.add('open');
      overlay.classList.add('open');
      toggle.setAttribute('aria-expanded', 'true');
      drawer.setAttribute('aria-hidden', 'false');
      overlay.setAttribute('aria-hidden', 'false');
      document.documentElement.style.overflow = 'hidden';
    };
    const closeDrawer = () => {
      if (!drawer || !overlay || !toggle) return;
      drawer.classList.remove('open');
      overlay.classList.remove('open');
      toggle.setAttribute('aria-expanded', 'false');
      drawer.setAttribute('aria-hidden', 'true');
      overlay.setAttribute('aria-hidden', 'true');
      document.documentElement.style.overflow = '';
    };
    toggle?.addEventListener('click', openDrawer);
    closeBtn?.addEventListener('click', closeDrawer);
    overlay?.addEventListener('click', closeDrawer);
    window.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeDrawer(); });

    // Drawer accordion toggles
    const toggles = Array.from(document.querySelectorAll('.drawer-acc-toggle'));
    toggles.forEach((btn) => {
      const id = btn.getAttribute('aria-controls');
      const panel = id ? document.getElementById(id) : btn.closest('.drawer-acc-row')?.nextElementSibling;
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', expanded ? 'false' : 'true');
        if (panel) {
          panel.classList.toggle('open', !expanded);
          panel.style.maxHeight = !expanded ? (panel.scrollHeight + 'px') : '0px';
        }
      });
    });

    /* ----- Sticky / Fixed fallback ----- */
    // Spacer prevents layout jump when we switch to fixed
    const spacer = document.createElement('div');
    spacer.style.height = '0px';
    nav.after(spacer);

    // Sentinel before the nav to detect when it scrolls off the top
    const sentinel = document.createElement('div');
    sentinel.setAttribute('aria-hidden', 'true');
    nav.parentNode.insertBefore(sentinel, nav);

    const applyShadow = () => {
      if (window.scrollY > 6) nav.classList.add('is-stuck');
      else nav.classList.remove('is-stuck');
    };

    const io = new IntersectionObserver(
      (entries) => {
        const e = entries[0];
        // When sentinel is NOT intersecting, nav has reached the top
        if (!e.isIntersecting) {
          nav.classList.add('fixed');
          spacer.style.height = nav.offsetHeight + 'px';
        } else {
          nav.classList.remove('fixed');
          spacer.style.height = '0px';
        }
        applyShadow();
      },
      { rootMargin: '0px 0px 0px 0px', threshold: 0 }
    );
    io.observe(sentinel);

    // Initial state
    applyShadow();
    window.addEventListener('scroll', applyShadow, { passive: true });
    window.addEventListener('resize', () => {
      if (nav.classList.contains('fixed')) spacer.style.height = nav.offsetHeight + 'px';
    });
  });
</script>
